
        <!DOCTYPE html>
        <html lang="en">
        <head>
            <meta charset="UTF-8">
            <meta name="viewport" content="width=device-width, initial-scale=1.0">
            <title>Preview Layout</title>
            
            <!-- Load React và các dependencies -->
            <script crossorigin src="https://unpkg.com/react@17/umd/react.production.min.js"></script>
            <script crossorigin src="https://unpkg.com/react-dom@17/umd/react-dom.production.min.js"></script>
            
            <!-- Load D3 (dependency của Recharts) -->
            <script src="https://d3js.org/d3.v7.min.js"></script>
            
            <!-- Load Recharts dependencies -->
            <script src="https://unpkg.com/prop-types@15.8.1/prop-types.min.js"></script>
            <script src="https://unpkg.com/victory-core/dist/victory-core.min.js"></script>
            
            <!-- Load Recharts -->
            <script src="https://cdnjs.cloudflare.com/ajax/libs/recharts/2.1.12/Recharts.js"></script>
            
            <!-- Load các thư viện khác -->
            <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.1/moment.min.js"></script>
            <link rel="stylesheet" href="https://unpkg.com/antd@4.24.15/dist/antd.min.css" />
            <script src="https://unpkg.com/antd@4.24.15/dist/antd.min.js"></script>
            
            <style>
                /* CSS cho Chart */
                .chart-wrapper {
                    position: relative;
                    width: 100%;
                    overflow-x: auto;
                    overflow-y: hidden;
                    padding-bottom: 15px;
                }
            
                .chart-container {
                    min-width: 100%;
                    height: 400px;
                }
                
                .chart-title {
                    text-align: center;
                    margin: 10px 0;
                    color: #1890ff;
                }

                /* CSS cho Table */
                .ant-table-wrapper { width: 100%; }
                .ant-table { font-size: 14px; width: 100%; border-collapse: collapse; }
                .ant-table-thead > tr > th {
                    background: #fafafa;
                    color: rgba(0, 0, 0, 0.85);
                    font-weight: 500;
                    padding: 12px 16px;
                    border-bottom: 1px solid #f0f0f0;
                }
                .ant-table-tbody > tr > td {
                    padding: 12px 16px;
                    border-bottom: 1px solid #f0f0f0;
                }
                .ant-table-tbody > tr:hover > td {
                    background: #fafafa;
                    cursor: pointer;
                }
                tr.selected { background-color: #e6f7ff !important; }
            </style>

            <script>
                // Thêm định nghĩa DEFAULT_CHART_CONFIG
                const DEFAULT_CHART_CONFIG = {
                    types: {
                        series1: 'bar',
                        series2: 'bar'
                    },
                    colors: {
                        fill1: "#1890ff",
                        fill2: "#ff4d4f"
                    }
                };

                // Thêm hàm getChartProperties
                function getChartProperties(tableId) {
                    if (!window.tableData) window.tableData = {};
                    if (!window.tableData[tableId]) window.tableData[tableId] = {};
                    if (!window.tableData[tableId].chartProperties) {
                    window.tableData[tableId].chartProperties = {
                        chartType1: DEFAULT_CHART_CONFIG.types.series1,
                        chartType2: DEFAULT_CHART_CONFIG.types.series2,
                        fill1: DEFAULT_CHART_CONFIG.colors.fill1,
                        fill2: DEFAULT_CHART_CONFIG.colors.fill2
                    };
                    }
                    return window.tableData[tableId].chartProperties;
                }


                // Định nghĩa hàm updateRelatedCharts
                function updateRelatedCharts(tableId) {
                document.querySelectorAll('.chart-container').forEach(chartContainer => {
                    const chartId = chartContainer.id;
                    const chartScript = document.querySelector(`script[data-chart-id="${chartId}"]`);
                    const xAxisRotation = parseInt(chartScript.getAttribute('data-x-axis-rotation')) || 0;

                    if (chartScript && chartScript.getAttribute('data-target-table') === tableId) {
                        const table = document.querySelector(`table[data-id="${tableId}"]`);
                        if (!table) return;

                        const headerCells = Array.from(table.querySelectorAll('thead th'));
                        const rows = Array.from(table.querySelectorAll('tbody tr'));

                        // Lấy properties từ script
                        const chartType1 = chartScript.getAttribute('data-chart-type1');
                        const chartType2 = chartScript.getAttribute('data-chart-type2');
                        const fill1 = chartScript.getAttribute('data-fill1');
                        const fill2 = chartScript.getAttribute('data-fill2');
                        const series1Name = chartScript.getAttribute('data-series1-name');
                        const series2Name = chartScript.getAttribute('data-series2-name');

                        // Transform data
                        const newData = rows.map(row => {
                            const rowData = {};
                            Array.from(row.cells).forEach((cell, index) => {
                                const columnName = headerCells[index]?.getAttribute('data-column');
                                if (columnName) {
                                    rowData[columnName] = cell.textContent.trim();
                                }
                            });
                            return rowData;
                        });

                        try {
                            const {
                                ComposedChart, Line, Bar, XAxis, YAxis, 
                                CartesianGrid, Tooltip, Legend, Area,
                                ResponsiveContainer
                            } = window.Recharts;

                            const chartData = newData.map(row => ({
                                name: row[chartScript.getAttribute('data-name-field')],
                                series1: parseFloat(row[chartScript.getAttribute('data-value-field1')]) || 0,
                                series2: parseFloat(row[chartScript.getAttribute('data-value-field2')]) || 0
                            }));

                            const needScroll = chartData.length > 10;

                            // Lấy component tương ứng với type
                            const getChartComponent = (type) => {
                                switch(type.toLowerCase()) {
                                    case 'line':
                                        return window.Recharts.Line;
                                    case 'bar':
                                        return window.Recharts.Bar;
                                    case 'area':
                                        return window.Recharts.Area;
                                    default:
                                        return window.Recharts.Bar;
                                }
                            };

                            const ChartType1Component = getChartComponent(chartType1);
                            const ChartType2Component = getChartComponent(chartType2);

                            const ChartComponent = React.createElement(ResponsiveContainer, 
                                { width: '100%', height: 400 },
                                React.createElement(ComposedChart, {
                                    data: chartData,
                                    margin: { top: 30, right: 80, left: 80, bottom: xAxisRotation ? 100 : 60 }
                                }, [
                                    React.createElement(CartesianGrid, { strokeDasharray: "3 3" }),
                                    React.createElement(XAxis, { 
                                        dataKey: 'name',
                                        height: 80,
                                        interval: 0,
                                        tickFormatter: (value) => {
                                            return value && value.length > 10 
                                                ? value.substring(0, 10) + "..." 
                                                : value;
                                        },
                                        tick: {
                                            angle: xAxisRotation,
                                            textAnchor: xAxisRotation ? "end" : "middle",
                                            fontSize: needScroll ? 11 : 12
                                        }
                                    }),
                                    React.createElement(YAxis, {
                                        yAxisId: 'left',
                                        orientation: 'left',
                                        width: 70,
                                        stroke: fill1
                                    }),
                                    React.createElement(YAxis, {
                                        yAxisId: 'right',
                                        orientation: 'right',
                                        width: 70,
                                        stroke: fill2
                                    }),
                                    React.createElement(Tooltip),
                                    React.createElement(Legend),
                                    React.createElement(ChartType1Component, {
                                        yAxisId: 'left',
                                        dataKey: 'series1',
                                        name: series1Name || "Series 1",
                                        fill: fill1,
                                        stroke: fill1
                                    }),
                                    React.createElement(ChartType2Component, {
                                        yAxisId: 'right',
                                        dataKey: 'series2',
                                        name: series2Name || "Series 2",
                                        fill: fill2,
                                        stroke: fill2
                                    })
                                ])
                            );

                            ReactDOM.render(ChartComponent, chartContainer);
                        } catch (error) {
                            console.error('Error updating chart:', error);
                        }
                    }
                });
            }

                // Các hàm xử lý khác
                function el(e,t,a){window.tableStates||(window.tableStates={}),window.tableData||(window.tableData={});let s=document.querySelector('table[data-id="'.concat(e,'"]'));if(!s)return;s.querySelectorAll("tbody tr").forEach(e=>e.classList.remove("selected"));let r=s.querySelector('tbody tr[data-row-key="'.concat(t,'"]'));if(!r)return;r.classList.add("selected");let n={},l=s.querySelectorAll("thead th");Array.from(r.cells).forEach((e,t)=>{var a;let s=null===(a=l[t])||void 0===a?void 0:a.getAttribute("data-column");s&&(n[s]=e.textContent.trim())}),window.tableStates[e]={selectedRecord:n,selectedRowIndex:t,selectedElement:r}}
                function ei(e,t,a){let s=Array.from(document.querySelector('table[data-id="'.concat(t,'"]')).rows[0].cells).map(e=>({title:e.textContent,dataIndex:e.getAttribute("data-column")})),r=document.createElement("div");r.innerHTML='\n        <form id="form-'.concat(e,'">\n            ').concat(s.map(e=>{var s;return'\n                <div style="margin-bottom: 16px;">\n                    <label style="display: block; margin-bottom: 8px;">'.concat(e.title,'</label>\n                    <input \n                        class="ant-input" \n                        name="').concat(e.dataIndex,'"\n                        value="').concat("update"===a&&(null===(s=tableStates[t])||void 0===s?void 0:s.selectedRecord[e.dataIndex])||"",'"\n                        style="width: 100%"\n                    />\n                </div>\n            ')}).join(""),"\n        </form>\n    "),window.antd.Modal.info({title:"create"===a?"Create New Record":"Update Record",content:React.createElement("div",{dangerouslySetInnerHTML:{__html:r.innerHTML}}),width:600,okText:"Submit",cancelText:"Cancel",onOk:()=>(ec(e,t,a),Promise.resolve())})}
                function eo(e,t,a){var s,r,n;if(console.log("Button clicked:",{buttonId:e,buttonType:t,targetTableId:a}),!document.querySelector('table[data-id="'.concat(a,'"]'))){window.antd.message.error("Kh\xf4ng t\xecm thấy bảng mục ti\xeau");return}switch(window.tableStates||(window.tableStates={}),t){case"create":ei(e,a,"create");break;case"update":if(!(null===(s=window.tableStates[a])||void 0===s?void 0:s.selectedRecord)){window.antd.message.warning("Vui l\xf2ng chọn một bản ghi để cập nhật");return}ei(e,a,"update");break;case"delete":if(!(null===(r=window.tableStates[a])||void 0===r?void 0:r.selectedRecord)){window.antd.message.warning("Vui l\xf2ng chọn một bản ghi để x\xf3a");return}case"delete":if(console.log("Delete case triggered"),!(null===(n=window.tableStates[a])||void 0===n?void 0:n.selectedRecord)){window.antd.message.warning("Vui l\xf2ng chọn một bản ghi để x\xf3a");return}window.antd.Modal.confirm({title:"Delete Confirmation",content:"Are you sure you want to delete this record?",okText:"Yes",okType:"danger",cancelText:"No",keyboard:!0,maskClosable:!0,onOk(){ed(a)}})}}
                function ec(e,t,a){let s=Object.fromEntries(new FormData(document.querySelector("#form-".concat(e))).entries()),r=document.querySelector('table[data-id="'.concat(t,'"]'));if("create"===a){let e=r.insertRow(-1);Object.values(s).forEach(t=>{let a=e.insertCell();a.textContent=t,a.className="ant-table-cell"}),antd.message.success("Record created successfully"),eu(t)}else{let e=r.querySelector("tr.selected");e&&(Object.values(s).forEach((t,a)=>{e.cells[a].textContent=t}),antd.message.success("Record updated successfully"),eu(t))}}
                function ed(e){var t;let a=window.tableStates[e];if(!(null==a?void 0:a.selectedElement)){window.antd.message.warning("Vui l\xf2ng chọn bản ghi để x\xf3a");return}let s=document.querySelector('table[data-id="'.concat(e,'"]'));if(!s)return;let r=document.querySelector('script[data-chart-id^="chart-"][data-target-table="'.concat(e,'"]'));console.log("Chart script found:",r),console.log("Chart type 1:",null==r?void 0:r.getAttribute("data-chart-type1")),console.log("Chart type 2:",null==r?void 0:r.getAttribute("data-chart-type2"));let n=(null===(t=window.tableData[e])||void 0===t?void 0:t.chartProperties)||{};console.log("Existing properties:",n);let l={...n,chartType1:n.chartType1||(null==r?void 0:r.getAttribute("data-chart-type1"))||er.types.series1,chartType2:n.chartType2||(null==r?void 0:r.getAttribute("data-chart-type2"))||er.types.series2,series1Name:n.series1Name||(null==r?void 0:r.getAttribute("data-series1-name")),series2Name:n.series2Name||(null==r?void 0:r.getAttribute("data-series2-name")),fill1:n.fill1||(null==r?void 0:r.getAttribute("data-fill1"))||er.colors.fill1,fill2:n.fill2||(null==r?void 0:r.getAttribute("data-fill2"))||er.colors.fill2,xAxisRotation:n.xAxisRotation||parseInt(null==r?void 0:r.getAttribute("data-x-axis-rotation"))||0};console.log("Saved chart properties:",l),window.tableData[e]||(window.tableData[e]={});let i=[{...l}];console.log("Saved chart properties:",i[0]);let o=s.querySelector('tr[data-row-key="'.concat(a.selectedRowIndex,'"]'));o&&o.remove();let c=Array.from(s.querySelectorAll("tbody tr")),d=Array.from(s.querySelectorAll("thead th")).map(e=>e.getAttribute("data-column"));window.tableData[e].data=c.map(e=>{let t={};return Array.from(e.cells).forEach((e,a)=>{d[a]&&(t[d[a]]=e.textContent.trim())}),t}),window.tableStates[e]={selectedRecord:null,selectedRowIndex:null,selectedElement:null};let p=s.querySelector("tbody");p&&Array.from(p.children).forEach((t,a)=>{t.setAttribute("data-row-key",a),t.onclick=t=>el(e,a,t)}),eu(e,i),window.antd.message.success("Đ\xe3 x\xf3a bản ghi th\xe0nh c\xf4ng")}
            </script>
        </head>
        <body>
            <div id="container">
                
                
                <div class="content-wrapper">
                    
                            <div class="component-wrapper"
                                style="
                                    left: 220px;
                                    top: 160px;
                                    width: 32px;
                                    position: absolute;
                                    z-index: 1;
                                "
                            >
                                
                <button 
                    class="ant-btn ant-btn-primary" 
                    style="width: 32px"
                    data-id="1734577589808"
                    data-type="delete"
                    data-target-table=""
                    onclick="handleButtonClick('1734577589808', 'delete', 'undefined')"
                    disabled
                >
                    Delete
                </button>
            
                            </div>
                        
                            <div class="component-wrapper"
                                style="
                                    left: 220px;
                                    top: 240px;
                                    
                                    position: absolute;
                                    z-index: 1;
                                "
                            >
                                <input 
                class="ant-input" 
                placeholder="Input field"
                style="width: 200px"
            />
                            </div>
                        
                            <div class="component-wrapper"
                                style="
                                    left: 460px;
                                    top: 100px;
                                    
                                    position: absolute;
                                    z-index: 1;
                                "
                            >
                                
                <button 
                    class="ant-btn ant-btn-primary" 
                    style="width: autopx"
                    data-id="1734577621372"
                    data-type="default"
                    data-target-table=""
                    onclick="handleButtonClick('1734577621372', 'default', 'undefined')"
                    disabled
                >
                    default
                </button>
            
                            </div>
                        
                </div>

                
            </div>
        </body>
        </html>